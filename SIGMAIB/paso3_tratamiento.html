<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario Tratamiento | SIGMA-IB</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header>
  <img src="img/logo_imss.png" alt="Logo IMSS">
  <div class="titulo-centro">
    Sistema Integral de Gestión Médica y Ambulancias<br><small>(SIGMA-IB)</small>
  </div>
  <img src="img/Sigma-ib.png" alt="Logo SIGMA">
</header>

<div class="eslogan">“Coordinamos traslados. Protegemos vidas.”</div>

<h1>Formato de Solicitud de Traslado Interhospitalario</h1>
<h2><u>Sección 3: Información del Tratamiento</u></h2>

<form id="formTratamiento">
    <input type="hidden" name="formulario_origen" value="Tratamiento" />  

    <div style="grid-column: span 2;">
        <label for="codigo_traslado">Código de Traslado</label>
        <input type="text" id="codigo_traslado" name="codigo_traslado" readonly>
      </div>
      
<!-- Sedación -->
<div>
    <label for="medicamento_sedacion">Medicamento Sedación</label>
    <select id="medicamento_sedacion" name="medicamento_sedacion" required>
      <option value="">Seleccione</option>
      <option value="Midazolam">Midazolam</option>
      <option value="Propofol">Propofol</option>
      <option value="Dexmedetomidina">Dexmedetomidina</option>
    </select>
  </div>
  <div>
    <label for="dosis_sedacion">Dosis Sedación (ml/hr)</label>
    <input type="number" step="0.1" min="0" name="dosis_sedacion" id="dosis_sedacion" required>
  </div>
  
  <!-- Analgesia -->
  <div>
    <label for="medicamento_analgesia">Medicamento Analgesia</label>
    <select id="medicamento_analgesia" name="medicamento_analgesia" required>
      <option value="">Seleccione</option>
      <option value="Fentanilo">Fentanilo</option>
      <option value="Morfina">Morfina</option>
      <option value="Buprenorfina">Buprenorfina</option>
      <option value="Tramadol">Tramadol</option>
    </select>
  </div>
  <div>
    <label for="dosis_analgesia">Dosis Analgesia (ml/hr)</label>
    <input type="number" step="0.1" min="0" name="dosis_analgesia" id="dosis_analgesia" required>
  </div>
  
  <!-- Vasopresor -->
  <div>
    <label for="medicamento_vasopresor">Medicamento Vasopresor</label>
    <select id="medicamento_vasopresor" name="medicamento_vasopresor" required>
      <option value="">Seleccione</option>
      <option value="Noradrenalina">Noradrenalina</option>
      <option value="Dopamina">Dopamina</option>
      <option value="Adrenalina">Adrenalina</option>
      <option value="Dobutamina">Dobutamina</option>
      <option value="Vasopresina">Vasopresina</option>
    </select>
  </div>
  <div>
    <label for="dosis_vasopresor">Dosis Vasopresor (ml/hr)</label>
    <input type="number" step="0.1" min="0" name="dosis_vasopresor" id="dosis_vasopresor" required>
  </div>
  

  <!-- Otro Medicamento -->
  <div style="grid-column: span 2;">
    <label for="otro_medicamento">¿Otro medicamento (doble sedación/analgesia/vasopresor)?</label>
    <select id="otro_medicamento" name="otro_medicamento">
      <option value="">No</option>
      <option value="Sí">Sí</option>
    </select>
    <div id="campo_otro_medicamento" class="campo-condicional">
      <input type="text" name="otro_medicamento_detalle" placeholder="Especifique nombre y dosis">
    </div>
  </div>

  <!-- Tratamiento complementario -->
    
  <div style="grid-column: span 2;"></div>
    <label for="tratamiento_complementario">Tratamiento Complementario</label>
    <input type="text" name="otro" placeholder="Describa el resto del tratamiento">
  </div>

  <!-- Bomba de infusión -->
  <div>
    <label for="bomba_infusion">¿Requiere bomba de infusión?</label>
    <select id="bomba_infusion" name="bomba_infusion">
      <option value="">Seleccione</option>
      <option value="Sí">Sí</option>
      <option value="No">No</option>
    </select>
    <div id="campo_cuantas_bombas">
      <label for="cuantas">¿Cuántas?</label>
      <input type="number" name="cuantas" min="1">
    </div>
  </div>

  <!-- Ventilador -->
  <div>
    <label for="ventilador_traslado">¿Requiere ventilador?</label>
    <select id="ventilador_traslado" name="ventilador_traslado">
      <option value="">Seleccione</option>
      <option value="Sí">Sí</option>
      <option value="No">No</option>
    </select>

    <div id="campos_ventilador">
      <label>Modo de ventilación</label>
      <input type="text" name="modo_ventilacion">

      <label>FiO2</label>
      <input type="text" name="fio2">

      <label>PEEP</label>
      <input type="text" name="peep">

      <label>FR</label>
      <input type="text" name="fr">
    </div>
  </div>

  <!-- Incubadora -->
  <div>
    <label for="incubadora">¿Requiere incubadora?</label>
    <select name="incubadora" required>
      <option value="">Seleccione</option>
      <option value="Sí">Sí</option>
      <option value="No">No</option>
    </select>
  </div>

  <!-- Otro dispositivo -->
  <div style="grid-column: span 2;">
    <label for="otro">¿Otro dispositivo médico?</label>
    <input type="text" name="otro" placeholder="Describa si hay algún otro dispositivo necesario">
  </div>

  <button type="submit">Guardar y Continuar</button>
</form>

<script>
  document.getElementById("codigo_traslado").value = localStorage.getItem("codigo_traslado") || "";

  // Otro medicamento
  document.getElementById("otro_medicamento").addEventListener("change", function () {
    document.getElementById("campo_otro_medicamento").style.display = this.value === "Sí" ? "block" : "none";
  });

  // Tratamiento complementario: mostrar campos si están seleccionados
  document.querySelectorAll('.detalle-complementario').forEach(input => {
    input.style.display = 'none';
  });

  document.querySelectorAll('input[type="checkbox"][name="tratamiento_complementario"]').forEach(checkbox => {
    checkbox.addEventListener('change', function () {
      const related = document.querySelector(`.detalle-complementario[data-opcion="${this.value}"]`);
      if (this.checked) {
        related.style.display = 'block';
      } else {
        related.value = '';
        related.style.display = 'none';
      }
    });
  });

  // Bomba de infusión
  const bomba = document.getElementById("bomba_infusion");
  const campoBomba = document.getElementById("campo_cuantas_bombas");
  campoBomba.style.display = "none";
  bomba.addEventListener("change", function () {
    campoBomba.style.display = bomba.value === "Sí" ? "block" : "none";
  });

  // Ventilador
  const vent = document.getElementById("ventilador_traslado");
  const camposVent = document.getElementById("campos_ventilador");
  camposVent.style.display = "none";
  vent.addEventListener("change", function () {
    camposVent.style.display = vent.value === "Sí" ? "block" : "none";
  });

  // Envío
  document.getElementById("formTratamiento").addEventListener("submit", function (e) {
    e.preventDefault();
    const formData = new FormData(this);
    formData.append("formulario_origen", "Tratamiento");

    fetch("https://script.google.com/macros/s/AKfycbzFn969rKf6A_e8t-oRc2clUvHAWwZkWKuZk58K8Mien-qb0ZArdqHwjxknMKyQ1pbJBQ/exec", {
  method: "POST",
  body: new URLSearchParams(formData)
})

    .then(res => res.text())
    .then(data => {
      if (data.trim() === "OK") {
        alert("Tratamiento guardado correctamente.");
        window.location.href = "paso4_recepcion.html";
      } else {
        alert("Error del servidor: " + data);
      }
    })
    .catch(err => alert("Error de conexión: " + err.message));
  });
</script>

</body>
</html>
