<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dashboard | SIGMA-IB</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
      body {
          font-family: Arial, sans-serif;
          background-color: #f6f4f2;
          color: #333;
          text-align: center;
          margin: 0;
          padding-top: 70px;
      }
      h1 { color: #006341; margin-top: 0; }
      nav {
          position: fixed; top: 0; left: 0; width: 100%;
          background: #006341; padding: 10px 0;
          display: flex; justify-content: center; gap: 20px;
          z-index: 999; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      }
      nav button {
          background: #fff; color: #006341;
          border: none; padding: 10px 20px;
          border-radius: 20px; font-size: 16px;
          cursor: pointer; transition: background 0.3s;
      }
      nav button:hover {
          background: #004d2f; color: #fff;
      }
      .metrics {
          display: flex; justify-content: center; flex-wrap: wrap;
          gap: 20px; margin-bottom: 40px;
      }
      .metric {
          background: #fff; padding: 20px;
          border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
          width: 200px;
      }
      .metric h2 { margin: 0; color: #006341; }
      .charts {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 20px; justify-items: center; padding: 20px;
      }
      canvas {
          background: #fff; padding: 10px;
          border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
          width: 100%; max-width: 300px; height: 250px !important;
      }
  </style>
</head>
<body>

  <header>
    <img src="img/logo_imss.png" alt="IMSS" />
    <div class="titulo-centro">
      Sistema Integral de Gestión Médica y Ambulancias<br />
      <small><strong>(SIGMA-IB)</strong></small>
    </div>
    <img src="img/Sigma-ib.png" alt="SIGMA" />
  </header>

  <nav>
    <button onclick="loadData()">Actualizar Datos</button>
    <button onclick="window.location.href='paso1_traslado.html'">Solicitud de Traslado</button>
    <button onclick="window.location.href='buscar_traslado.html'">Buscar Traslado</button>
</nav>

<h1>Dashboard Gerencial - SIGMA-IB</h1>

<div id="metrics" class="metrics">
    <div class="metric"><h2 id="total_traslados">0</h2><p>Total Traslados</p></div>
    <div class="metric"><h2 id="total_ambulancias">0</h2><p>Total Ambulancias</p></div>
    <div class="metric"><h2 id="total_incidentes">0</h2><p>Total Incidentes</p></div>
    <div class="metric"><h2 id="total_pendientes">0</h2><p>Traslados Pendientes</p></div>
</div>

<div id="charts" class="charts">
  <canvas id="grafico_dia"></canvas>
  <canvas id="grafico_sexo"></canvas>
  <canvas id="grafico_edad"></canvas>
  <canvas id="grafico_unidad_solicitante"></canvas>
  <canvas id="grafico_unidad_receptor"></canvas>
  <canvas id="grafico_prioridad_traslado"></canvas>
  <canvas id="grafico_tipo_traslado"></canvas>
  <canvas id="grafico_incidentes"></canvas>
</div>

<script>
    const apiUrl = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLhmNUdY-JjoidI-kGbvzqGyiLq0Ff7aqcqDrrgxfzE5C9B8DI6wpvyEuS46fps5-ni2Hf6IJj-lmEKyhpqmZOJlNGW4D-xx8UZvtquYCipNxYhhlvsRHq81xXJPZlhbmVUgGSdjot4NJi70cMX9IIi3fKP4Soai_dLrEhcF9-3qWtixxQIWzpODT4cFIosKIJl-cbrLjqYZnWLE5UqxKteGDpQ02tT0Hg5TGIW-RKQEoAqke7ppwIRoWt-Q94fHrYeQQ0UCmLPHWfY7fNHdQtzzN8DGqkwjR93THK27&lib=Md-wS-bTsKZaSMMaxL34hy2CbNoL2JyFz";

    const chartInstances = {};

    const colores = [
    '#006341', '#004d2f', '#009c74', '#66cdaa', '#3b8b6e',
    '#00755e', '#008b8b', '#2e8b57', '#20b2aa', '#48d1cc'
];

    function loadData() {
        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                document.getElementById("total_traslados").textContent = data.total_traslados;
                document.getElementById("total_ambulancias").textContent = data.total_ambulancias;
                document.getElementById("total_incidentes").textContent = data.total_incidentes;
                document.getElementById("total_pendientes").textContent = data.total_pendientes;

                renderChart("grafico_dia", "Traslados por Día", "bar", data.grafico_dia);
                renderChart("grafico_sexo", "Distribución por Sexo", "pie", data.grafico_sexo);
                renderChart("grafico_edad", "Distribución por Edad", "bar", data.grafico_edad);
                renderChart("grafico_unidad_solicitante", "Unidades Solicitantes", "doughnut", data.grafico_unidad_solicitante);
                renderChart("grafico_unidad_receptor", "Unidades Receptoras", "doughnut", data.grafico_unidad_receptor);
                renderChart("grafico_prioridad_traslado", "Prioridad de Traslado", "pie", data.grafico_prioridad_traslado);
                renderChart("grafico_tipo_traslado", "Tipo de Traslado", "pie", data.grafico_tipo_traslado);
                renderChart("grafico_incidentes", "Incidentes por Gravedad", "pie", data.grafico_incidentes);
            })

            .catch(err => console.error("Error al cargar datos: ", err));
    }

    function renderChart(id, title, type, dataset) {
        const ctx = document.getElementById(id).getContext("2d");

        if (chartInstances[id]) chartInstances[id].destroy();

        const chartColors = colores.slice(0, dataset.labels.length);

        chartInstances[id] = new Chart(ctx, {
            type: type,
            data: {
                labels: dataset.labels,
                datasets: [{
                    label: title,
                    data: dataset.values,
                    backgroundColor: chartColors,
                    borderColor: '#006341',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: title,
                        color: '#006341',
                        font: { size: 16 }
                    },
                    legend: { position: 'bottom' }
                },
                scales: type === "bar" ? {
                    y: { beginAtZero: true }
                } : {}
            }
        });
    }

    function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    window.onload = loadData;
</script>

</body>
</html>